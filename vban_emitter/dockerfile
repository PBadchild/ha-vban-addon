ARG BUILD_FROM=debian:bullseye-slim
FROM ${BUILD_FROM}

ENV DEBIAN_FRONTEND=noninteractive

# Install dependencies and build vban
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        libasound2-dev \
        autoconf \
        automake \
        git \
        ffmpeg \
        bash \
        dos2unix \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Copy and build vban
COPY vban_source /tmp/vban
WORKDIR /tmp/vban
RUN ./autogen.sh \
    && ./configure --prefix=/usr --enable-alsa \
    && make \
    && make install \
    && rm -rf /tmp/vban

# Copy and set permissions for run script
COPY run.sh /run.sh
RUN chmod +x /run.sh && dos2unix /run.sh

CMD ["/bin/bash", "/run.sh"]