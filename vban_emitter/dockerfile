ARG BUILD_FROM
FROM ${BUILD_FROM}

ENV DEBIAN_FRONTEND=noninteractive

# Install dependencies
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        libasound2-dev \
        git \
        ffmpeg \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Copy run script and placeholder for vban_emitter (replace with binary if available)
COPY run.sh /run.sh
RUN chmod +x /run.sh

# If you have a vban_emitter binary, copy it (e.g., COPY vban_emitter /usr/bin/vban_emitter)
# Otherwise, this will fail until you provide the binary or source
# WORKDIR /tmp/vban  # Remove if no source build
# COPY . /tmp/vban   # Remove if no source build
# RUN ./autogen.sh && ./configure --prefix=/usr --enable-alsa --disable-pulseaudio --disable-jack && make && make install
# RUN rm -rf /tmp/vban  # Remove if no source build

WORKDIR /
EXPOSE 6980/udp  # Optional, remove if redundant with config.json
CMD ["/run.sh"]